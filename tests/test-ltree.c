/*
 * SPDX-FileCopyrightText: 2023 Fox Crypto B.V.
 * SPDX-License-Identifier: MIT
 *
 * SPDX-FileContributor: Max Fillinger
 * SPDX-FileContributor: Pepijn Westen
 */

#include <stdio.h>
#include <stdbool.h>
#include <stdlib.h>
#include <string.h>

#include "config.h"
#include "xmss_tree.c"

#include "xmss_hashes.h"
#if XMSS_ENABLE_SHA256
#include "sha256_xmss_hashes.h"
#endif
#if XMSS_ENABLE_SHAKE256_256
#include "shake256_256_xmss_hashes.h"
#endif

static void print_output(const XmssNativeValue256 *output, const XmssNativeValue256 *expected_output)
{
    printf("Output:    ");
    for (int i = 0; i < XMSS_VALUE_256_WORDS; i++) {
        printf("0x%08x ", output->data[i]);
    }
    printf("\nExpected:  ");
    for (int i = 0; i < XMSS_VALUE_256_WORDS; i++) {
        printf("0x%08x ", expected_output->data[i]);
    }
    printf("\n");
}

#if XMSS_ENABLE_SHA256
static bool test_rand_hash_with_sha256(void)
{
    /* Inputs and expected output generated with Frans' C# implementation: github.com/dorssel/dotnet-xmss. */
    WotspPublicKey public_key = { {
        { { 0x3cbd8ab2, 0x1057b3e1, 0xda6c215d, 0x8baa5c6d, 0x59574bd9, 0x8ea57b4f, 0xf66857fc, 0xcf731e69 } },
        { { 0xbbf9966b, 0xf2184ff5, 0xe4a8614f, 0x2b1af161, 0x261e1607, 0xc85c34b5, 0xa3bc64ff, 0x0407c0ce } },
        { { 0xdb35e837, 0xb45a9016, 0x7a3f2e4a, 0x9e5bf9ab, 0xf5c099ea, 0x2aa1c09b, 0x376a96e4, 0x851cc557 } },
        { { 0x1cb78b0f, 0xf1e5366a, 0x6595809f, 0x36f0adf2, 0x546e44b4, 0x2cf6779d, 0x899e0c6f, 0xdf7ebd4a } },
        { { 0xc9416e69, 0x26bd79de, 0x0acbde03, 0x57f8a2c9, 0x2016d7ee, 0x99e05748, 0x912d6133, 0x1e5b1e74 } },
        { { 0xb383c390, 0xadc3587d, 0xf247c922, 0x1c8085be, 0xf34c2971, 0x91a0d7be, 0xf8d33458, 0x25d86e6c } },
        { { 0xb2e62c3f, 0x672c9ba1, 0x47a4a1ad, 0xf7d290f3, 0x02b3de89, 0xd9e2f719, 0x6f6d349c, 0xc08395d0 } },
        { { 0x417d4aac, 0x9c6869b8, 0xa87b76a5, 0x92e5fd92, 0x18718958, 0x63da8d11, 0xf0dcc9b9, 0x1d75910f } },
        { { 0xbdd2b181, 0x139da020, 0xb6ccca1a, 0x8abb3797, 0x0ef628fa, 0x50b7bc21, 0x06841fb8, 0x7164327c } },
        { { 0xbb74790c, 0x39c91a08, 0xefd1fabc, 0xc72461df, 0x988e7eb6, 0x775d4613, 0x70bc816f, 0xc5cd1d04 } },
        { { 0x81173995, 0xd4de53b8, 0xd79c31b3, 0x3c5ae9e5, 0x37e10536, 0x2ca5cade, 0x4c2636b1, 0xee8a2312 } },
        { { 0xdccc8142, 0xe16e5b19, 0xb776dddb, 0xad25b2f3, 0x439cf872, 0x6adb73e5, 0xd8dba7e8, 0xb9fa7b99 } },
        { { 0x623b58db, 0x9f387d02, 0xe4e00bf0, 0x99d92d82, 0x921ff4fd, 0x95853412, 0xe1375c02, 0x0664c909 } },
        { { 0xf20c0a9e, 0x1402fcdf, 0x7e4ec48c, 0xfde522b3, 0x80eaacdb, 0xde024d78, 0x8ff0257e, 0x3f61e202 } },
        { { 0x0d375725, 0x990c5eee, 0x2661c38b, 0x51fef0b7, 0x6ae45856, 0x9732946d, 0x84d0dda3, 0xb17a6bd0 } },
        { { 0x0356cf55, 0x9083d4dd, 0x49d14035, 0x07ec20c5, 0x705f10dd, 0x4275acb0, 0xac283f61, 0x750eb8d6 } },
        { { 0x680d9cc0, 0x21993ce2, 0x8d0a4eee, 0xb66e253d, 0x202d6b60, 0x8a2cc717, 0x63772718, 0x459bc108 } },
        { { 0x443a8a12, 0x1eea4b2f, 0x98ae22f9, 0x26eb6c3f, 0xe7d976e6, 0x20b0f5f4, 0xdbe763fd, 0x514c4729 } },
        { { 0xf7445ee9, 0xbd1cdf8a, 0xca66072c, 0xa03ae6a0, 0xd5c813b0, 0x7e5aa132, 0xc083bb8b, 0xeb4c2953 } },
        { { 0xceba32ca, 0x2cc26e75, 0x86fc4951, 0x0f466815, 0x7aeed5db, 0xa6f9e77e, 0xcd64c507, 0xd9dc7fa2 } },
        { { 0x3a2d308f, 0xab7a1843, 0x070e61c8, 0x44f68d18, 0xbc1a37c3, 0xe6bda76d, 0x95c46721, 0x376eee9a } },
        { { 0x93bc707c, 0xd8074285, 0x106a4e8d, 0x4d11fd97, 0xd4c39e30, 0xc0ca6ddf, 0x5c77e53c, 0x67054b6b } },
        { { 0x745eb20f, 0x0573f34b, 0xc9de4db9, 0x500da240, 0xf35e4e31, 0x69a2c9fe, 0x63c1fa9a, 0xe207512d } },
        { { 0x3b58ae84, 0xffa486be, 0x72dccc7e, 0x33b67a04, 0x505ed547, 0xe2a869ae, 0x3b261754, 0x67ffe9af } },
        { { 0x10d65eb8, 0x0f8c01b6, 0x88482236, 0x2c40f478, 0xe8ce54ef, 0x0ba983e2, 0xccfa99d0, 0x4310a2a1 } },
        { { 0xa05e7012, 0x792a370a, 0x6040486d, 0xa1482076, 0x34ab4295, 0xd0d43f6f, 0x387e672e, 0xcb1893bb } },
        { { 0x2bc0faec, 0x7518ef4d, 0x55c43a36, 0x615f3e4b, 0xd7c21b20, 0x166582b9, 0x2fefde94, 0xc0d41d5a } },
        { { 0x6036abc1, 0x7b6c204f, 0x1fd80c49, 0xbda44d1a, 0x0581976b, 0x13e6f7b1, 0x90a7fd69, 0x89cef4f8 } },
        { { 0x3ecfac49, 0xc59ac9df, 0x2e014c37, 0x6c4bdb5e, 0xdeb202e6, 0xbf79afeb, 0x71dd2acd, 0x9ac96ee7 } },
        { { 0x53568855, 0x59385a15, 0xd5883ea7, 0x5f16d2f0, 0xbc82aca5, 0x5530dfc0, 0x96d514e9, 0x9e09b8f8 } },
        { { 0xdb89e559, 0x41d9fc72, 0x5042cb28, 0xfdd1d665, 0x4bb2d690, 0x4d6e28a2, 0xcba2c920, 0xab908443 } },
        { { 0x975e1dac, 0x98d2601f, 0x6de883b6, 0x33a98679, 0x963faa63, 0x8ed22d5f, 0xdcc23bd5, 0x36874600 } },
        { { 0x2b2c44b4, 0x2af37d1f, 0x6a4a6381, 0x8763ea81, 0x96ce227e, 0x17476a7c, 0x7c86b620, 0x8da8a769 } },
        { { 0x8aba6810, 0x2e4924b8, 0xfb4bd96a, 0x71ea1492, 0xb31a2bba, 0x974f789c, 0xd1e4bcc1, 0x6e965e64 } },
        { { 0x86ebdfe4, 0xb5b906ba, 0xf82a162a, 0x48b80f34, 0x3d91f116, 0x6fd455bf, 0xecee4493, 0xc41f40ce } },
        { { 0xac942219, 0x9d906a22, 0x1be974b2, 0x30bcb560, 0x5f5d8876, 0x303baa19, 0xc288ec46, 0xa165b6d6 } },
        { { 0x5ddfa4b8, 0xd609b579, 0x03ce4d00, 0x845a465b, 0xc60acad5, 0xf6a17db8, 0x27334026, 0xdda3749a } },
        { { 0xcd2cbaa4, 0x8d2410b3, 0x9b316d90, 0x76301615, 0xd9820d89, 0x89b983f0, 0x883b8c39, 0xf6323ef6 } },
        { { 0x03d475ed, 0x5d7d9570, 0xe6b5f782, 0x8f97465d, 0x906b94a9, 0x9eff66d0, 0x0ec72226, 0x7948c343 } },
        { { 0x556113c7, 0xe66a6d91, 0x646a4632, 0x79d02fe7, 0xf0d3f73d, 0x094f49b9, 0x6217a97e, 0x3be0298c } },
        { { 0xc0cbd6af, 0xb36b73bd, 0xdbe24fb0, 0x5aa4b263, 0x185bf974, 0x92637b44, 0x8f64f736, 0xa9491f14 } },
        { { 0xf2812ccc, 0xdb18335e, 0x4bb1ad6e, 0x778f098d, 0xce8244cf, 0x0b528963, 0xebab8152, 0x217154cc } },
        { { 0xe463866f, 0xc838a4e2, 0x214bf6e2, 0x6988b6bb, 0xc4639912, 0x7b07b9df, 0xb0ce2408, 0x4c564f63 } },
        { { 0xee338760, 0xb6bf6a60, 0xbb9a6faf, 0x3857e62c, 0x54699aa6, 0x82448aa1, 0x046ddce6, 0x48ae7dc8 } },
        { { 0xa43ddddb, 0x72bdb093, 0xbbd81ebc, 0x306a9b34, 0x653f6b23, 0x7811b94f, 0xbc7f7da3, 0xa76ee645 } },
        { { 0x3a24df7c, 0xe00801da, 0xc2d4f4d1, 0xd97e99e4, 0xa96c11d8, 0x8606e3a1, 0x5f387e81, 0xeddbab9a } },
        { { 0xb4c69a9a, 0xbabf0b36, 0x0cb9de21, 0x820cf591, 0x98c4aabd, 0x2601e592, 0x0f3f14e1, 0x8bd8f887 } },
        { { 0x3ec24bbb, 0x8d7683ec, 0x7f6ebc17, 0x748d4587, 0xd98d6f9e, 0x614f7c43, 0xb5060600, 0x8b1eede1 } },
        { { 0x615f1492, 0xf61605d3, 0xfda70f73, 0xe4a21b94, 0x32aded87, 0x523d273a, 0xc1c099cd, 0x2a9c45e8 } },
        { { 0x26b801a2, 0xfda1bd78, 0xafb79835, 0x53682ada, 0xf811fe1e, 0x508272e4, 0xe44e1d10, 0xb9ff6727 } },
        { { 0x59d72d87, 0xc56b1a0e, 0x09ec938f, 0x26e73a26, 0x985afe52, 0xcb3f0434, 0x3debc59a, 0xdfa15a35 } },
        { { 0x1e2c4297, 0x5f66c07a, 0xb78e682f, 0x8176dcf3, 0x70b37ec2, 0x6f158350, 0x69d3f915, 0x1eef245e } },
        { { 0x7d1f0d6e, 0x57cd417c, 0xa919e25a, 0x5c998249, 0xf6a87379, 0x36665a6b, 0x1eee4f9a, 0xf3b2d838 } },
        { { 0x544777c9, 0xc8ea7ba4, 0x9242684f, 0xce5acb2f, 0xce1c1c4f, 0x11e8c30e, 0x8af2a561, 0xfdb2a8de } },
        { { 0xa2a25707, 0x2d65a8d3, 0x004d1cc3, 0x62d1b385, 0xae03b78e, 0x763b78d4, 0xa6282d82, 0xe5734d19 } },
        { { 0xafcb7649, 0x9e7253ca, 0xde41d541, 0x2d173b36, 0x5ba13009, 0x72a12fa2, 0xf16d741e, 0x3a138ba0 } },
        { { 0xf33617f5, 0xc5349add, 0x168a1885, 0x8fcb3a37, 0x0a256c17, 0xe05464a7, 0xdfaf9951, 0x367119e8 } },
        { { 0xd6b53e56, 0xf48a3878, 0xe07d9e79, 0xf5dfa967, 0xe7b9969b, 0x5c64a4f8, 0x14c4ce50, 0x487727ec } },
        { { 0x9cda636b, 0xd68d5de8, 0x5761be24, 0x6c687cb5, 0x23e1ae61, 0x985a630e, 0xa812945b, 0xec95bc8c } },
        { { 0xaee11f9b, 0xa7c09fa5, 0x2be5c203, 0x381d67a4, 0xc9b8850b, 0xaa594354, 0x354709c0, 0x83cc88e1 } },
        { { 0x8238b9a3, 0xc2255cde, 0xe68f2a3d, 0x8017a545, 0xc3161653, 0xc18e82c3, 0xa60bd027, 0xe0892223 } },
        { { 0xc7d67ad1, 0x20eab652, 0xcedd6494, 0x87e3e765, 0x20f08801, 0xd25bbe6e, 0xc2df5bf0, 0x5e9835a4 } },
        { { 0x16313a13, 0x3fb1afad, 0x50e274c7, 0x308f3e3a, 0xca0e5bf8, 0xefd5ecb7, 0x801a0ef0, 0x0a411cd8 } },
        { { 0xef2fbd65, 0x73171e00, 0x0ef2289e, 0x8e589460, 0x66902196, 0xf8e7d461, 0x99c9033b, 0x879f649f } },
        { { 0x2531bcee, 0x48298389, 0x0e237b84, 0x510e7508, 0xe34fc37a, 0xa864ef15, 0x781e6585, 0x7b1320ff } },
        { { 0xe9b59aa5, 0xa9cc86d1, 0xb880ff70, 0xc3af629a, 0xd82ce640, 0xa18d2301, 0x9b6df2df, 0x35a39b10 } },
        { { 0x51adf0d1, 0xe7bcabe8, 0x485f0e68, 0xc0c8ecd5, 0xb5b21960, 0x65ab868e, 0x0e64ed70, 0xe6863d34 } },
    } };
    uint32_t adrs[8] = {
        0x00000000, 0x00000000, 0x00000000, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    };
    const XmssNativeValue256 seed = { {
        0x20640b47, 0x23767c56, 0x1bdbd980, 0xe7a89afc, 0x46e045b4, 0x359615fe, 0x0fd10be0, 0x81307b88,
    } };
    const XmssNativeValue256 expected_output = { {
        0xe68ef023, 0x2cb77354, 0x325fea60, 0x0c6175cf, 0x9c9f8306, 0xf8a153f9, 0x0b9ab69f, 0xa6880731,
    } };

    XmssNativeValue256 output = {0};

    xmss_ltree(HASH_ABSTRACTION(&sha256_xmss_hashes) &output, &public_key, (ADRS*)adrs, &seed);

    const bool success = memcmp(&output, &expected_output, sizeof(XmssNativeValue256)) == 0;
    printf("rand hash function test %s for SHA256!\n", success ? "succeeded" : "failed");
    if (!success) {
        print_output(&output, &expected_output);
    }

    return success;
}
#endif /* XMSS_ENABLE_SHA256 */

#if XMSS_ENABLE_SHAKE256_256
static bool test_rand_hash_with_shake256_256(void)
{
    /* Inputs and expected output generated with Frans' C# implementation: github.com/dorssel/dotnet-xmss. */
    WotspPublicKey public_key = { {
        { { 0xc3ef0750, 0x969184d1, 0xaa735c9f, 0xca3dc53f, 0xc68e5aa3, 0x9a69594d, 0xd3479143, 0x22660618} },
        { { 0x3047d796, 0x163b530a, 0x829ef5d0, 0x9242dc36, 0xfe9b5bdd, 0xf9f4f4b7, 0x9e26a0d1, 0x5697df6d} },
        { { 0xa3617d2b, 0xfc8b9ec4, 0x2e5309d8, 0xb264988a, 0x65493e3c, 0x317f6179, 0x3398072a, 0x5afda9da} },
        { { 0x06abbe8d, 0x731d2944, 0x76c5dfc1, 0xf2f1ceaa, 0xe68c7ec0, 0x894c8266, 0x5e67eabf, 0x48be865a} },
        { { 0x4ecdb8a4, 0xa847a863, 0xc3cca30a, 0xe6448131, 0x45ef3244, 0x82af08c2, 0xce0866eb, 0x9d543e72} },
        { { 0xc5ea6136, 0x06925e45, 0xa00cdc15, 0x10d3aad4, 0x9b19595e, 0x97c6f8f1, 0x0c310ac9, 0xa6fc43b0} },
        { { 0xc5ccb0eb, 0x152200af, 0x675701c8, 0x3dc9f34b, 0x77302d9b, 0x17857fdf, 0xe23ff843, 0x3e9efefb} },
        { { 0x0cd5e41a, 0xb6b3c3f5, 0x97d4d48e, 0x85501b4b, 0xcd60a226, 0xf7b1f9c7, 0x83cf4c9e, 0x6bbc8d95} },
        { { 0x17330a38, 0x7eb57ef0, 0xf4907207, 0x5ccb728f, 0x06e2bfbf, 0xd23d7d10, 0xaee2b734, 0x1c302b8e} },
        { { 0xa8b594e9, 0x98418312, 0xc266b133, 0xb3c48375, 0x55e6b283, 0x1f760ae5, 0x5e60fa6f, 0x02ebd220} },
        { { 0xaa5f3640, 0xf2508a3c, 0x68cf0a6c, 0x434efdec, 0x4e4087f1, 0xa0bb59e5, 0xfd75de73, 0x095b3759} },
        { { 0x195092da, 0xc8ce6e0c, 0xcc038b6c, 0x209394fb, 0x5e1d8343, 0x5401e255, 0x4aea35cb, 0xc5e9956c} },
        { { 0x5a00b6f0, 0x8e64eeab, 0xc49792f6, 0x70df62d0, 0x85643e35, 0xd697f691, 0x6f6ab559, 0x3d41c6fc} },
        { { 0xa43ffe66, 0x08f966d7, 0x2f1538b2, 0x4b72103c, 0x7c360ebb, 0xb0460c7c, 0xfffa801d, 0x5e80ba1f} },
        { { 0x10d3924d, 0x66b7a8fc, 0xe5c63408, 0xe31df832, 0xfc63ffeb, 0xe9d9c63e, 0x40372fa4, 0x7598b7e5} },
        { { 0x375d8599, 0x50c1f636, 0xe4391523, 0xb4f2a0a5, 0x3a332925, 0x355e63cf, 0x347ce78d, 0xd71e6aa7} },
        { { 0x55891083, 0xf547396e, 0x66ae9e18, 0xcf72ccbf, 0x83bf1e8d, 0x63a7a08d, 0x03bb2aa7, 0x1e77b2fe} },
        { { 0x4ed5f5c5, 0x7fc43526, 0xce9f9c99, 0x9747931d, 0x4f6aeb17, 0x3912392b, 0xd9de5756, 0x5cbfd867} },
        { { 0x8e7f41fa, 0x48bbc11f, 0x9ea9becf, 0x79868827, 0xc9df6b19, 0x207cb445, 0x0b94b883, 0xbae3227e} },
        { { 0x6ef577d3, 0xf04d95a5, 0x5ed9210a, 0x467e5c33, 0x414d4e90, 0x593f532e, 0x39347d0b, 0xb3fff3cf} },
        { { 0x95464662, 0xe216cd01, 0x9a37a107, 0x81664ada, 0xb0d1df47, 0xc8dc7c7d, 0xdc61d1c9, 0x2e3cc3af} },
        { { 0x023a5ff2, 0xeb8276c0, 0xb816638f, 0x798606e7, 0x23fb7082, 0x46771eb5, 0x3f5920d6, 0xeabe261a} },
        { { 0x87e792c2, 0xf2ecf115, 0xd81c6798, 0xdb81aa98, 0x3e02e14d, 0xef12bf1b, 0x7a2a0db6, 0xc85449a1} },
        { { 0xa2c4c1d5, 0x0d76bed0, 0x80a3fe75, 0x662e5384, 0x0ce7e429, 0x130f3ff1, 0x765e416f, 0xa4e8ee3f} },
        { { 0x07ba93a0, 0x5c4b1e1f, 0x95331198, 0x268de5cf, 0x852cdcd0, 0x4644c1ae, 0xe64cd2ba, 0xa608fe46} },
        { { 0xda8f4580, 0x0cda5998, 0xa8e47e96, 0x5c0e29ba, 0xc8873db9, 0x95b4dae5, 0x2648b2b2, 0x6eb8cabb} },
        { { 0xcdf22415, 0x98afc4bc, 0x803da3a9, 0xaddcf506, 0xd12d2e4f, 0xc33a58cd, 0x530864a6, 0x3a095a9c} },
        { { 0xf55d9ff4, 0xc6360b7c, 0x4b531c57, 0x850076e8, 0x898f0cf3, 0x5e9b6f86, 0xfdbee369, 0xab65a8a5} },
        { { 0xdd5e28b3, 0x2e1e7948, 0xa852ec8c, 0x483e9bde, 0x5048fc32, 0x500b3afa, 0x2d229840, 0xbfd8c755} },
        { { 0xc4adcb94, 0xebf75936, 0xa23d72dd, 0x7ab02024, 0xde01a68d, 0x6c5089f4, 0x4aa794fd, 0x968f52e5} },
        { { 0x2ef635a6, 0x13032748, 0x56bc9c6d, 0x4f049a67, 0x7d23132e, 0xea2da24e, 0xe190b7de, 0x10275c32} },
        { { 0x69ba1bb8, 0x593dcace, 0x5b15866a, 0x9aa53479, 0x6e0887cb, 0x07bc65e1, 0xadd3019e, 0x37693f20} },
        { { 0xe257fd9e, 0x2eff2456, 0x43a13ac2, 0xaedc8744, 0xababf459, 0xd1e1b8da, 0xd3282616, 0xe8c99ea8} },
        { { 0x7e6f4296, 0x35351d49, 0x1d024604, 0x3ea2415e, 0x45cf94c9, 0x3c8c97d2, 0x785bbcc8, 0xe27fff53} },
        { { 0x563c1eb1, 0xd018b24c, 0x84d06241, 0x562526f3, 0x99a9a194, 0xb22d1d14, 0x0945d8a2, 0x8ccef5a4} },
        { { 0x99fe54c3, 0xae5f46e9, 0x7187592c, 0x46f54242, 0x10e20bfd, 0x3c5efc29, 0x245b1a2f, 0x7d95754a} },
        { { 0x809b8ecc, 0x0c3c7441, 0xfead2cf4, 0x72adfe9a, 0x369e4343, 0xef0e2fe7, 0xc9f0007e, 0xf5e7a0be} },
        { { 0x57d75e23, 0x9147bf5f, 0x9ef63501, 0xa36d1ce6, 0x8a042e50, 0x7f2822ba, 0x89e025fa, 0xe4907973} },
        { { 0x4c7b1cd8, 0x1f11b760, 0x0f3d8bfd, 0xbfcb81e0, 0x9671783f, 0xee39ded0, 0x1caf985f, 0x7f2ba0ba} },
        { { 0xf221e6e7, 0x61568364, 0x9e593665, 0xd47f9423, 0xe127a2ab, 0xbdb9e8f9, 0xc35e4227, 0xe65d5c87} },
        { { 0x719533f5, 0x8cf2939e, 0x3d289ed3, 0x62938620, 0xafdfb931, 0x5b892996, 0x9cf1735f, 0xe184a6e7} },
        { { 0x9f8f3eb5, 0xe4553e49, 0xda43b8b0, 0x77ebe5dd, 0x1d35f4e6, 0xcf65f2d3, 0xf35734ad, 0x7028a452} },
        { { 0x9a1490de, 0x4462fcb8, 0x9ee79dca, 0xd7e42195, 0x3bcbc409, 0xc3e148dd, 0xd4edc867, 0x5e472523} },
        { { 0xf700e5ca, 0x8013dc7f, 0x4cc397b3, 0xd1be9fcd, 0xf60e5c64, 0x32b2a040, 0xf117799d, 0x9cc1a39b} },
        { { 0x8dfff1e6, 0xb687fa32, 0x75473fbb, 0xbca16c0f, 0x33f27b83, 0x2b6db696, 0xcd69f0af, 0x850216b3} },
        { { 0xc7628161, 0x5f6755d5, 0xce59ee34, 0xa1565bed, 0xa385cf75, 0x88e3c467, 0xd0cd0af3, 0xbaee3ca9} },
        { { 0x5f8035a3, 0xc4bb1f0d, 0xe782d246, 0x7e97d94d, 0x40fbe039, 0xa8b37b5a, 0x1de97252, 0xf4910215} },
        { { 0xd925d9d5, 0xa36aac5c, 0x809aad70, 0x1535fa18, 0x71ddb66d, 0xc9ee7553, 0x41384754, 0x3d37a23f} },
        { { 0x9cbb9f82, 0x9c217407, 0xf3e6dc59, 0x01e97ac2, 0x63291b06, 0x4f24f354, 0x58728bc5, 0xb5f52fb2} },
        { { 0x788e8c50, 0xb57241a0, 0x2b179b60, 0x31227feb, 0x6ac6e8e3, 0x98854c27, 0x76b53d4c, 0x6f54e846} },
        { { 0xa445bf50, 0x5d49371c, 0x63fdd4e1, 0xcc5ae82c, 0x4a9d9ae7, 0xac302a5a, 0x5275396d, 0x07e5382b} },
        { { 0x371e973f, 0x10cda4be, 0x72a94c44, 0x073b3bee, 0xf99a4929, 0x9cad9ece, 0x9ba55086, 0xdc30bdb0} },
        { { 0x313e2fb2, 0xdbd10dcd, 0xd6f5915a, 0x645031ae, 0x07ab864e, 0x9fed7d12, 0xbea9d223, 0xd2e656b1} },
        { { 0x6b27830a, 0x52680804, 0xea80c2b3, 0xbb0e5913, 0xdac50e41, 0xd39b356b, 0xd65760b1, 0x90215128} },
        { { 0xa9f9bef4, 0x67099e80, 0x9a9de0d7, 0x0385499d, 0x91cbe7b7, 0x7aef2b67, 0xc4544455, 0xff93bb3e} },
        { { 0xbbe0a3a7, 0xa710c52b, 0x52029b64, 0x0e3edeae, 0xa68ea060, 0x71bf8355, 0x035ad9bf, 0x38a04de6} },
        { { 0x52df82ed, 0x022ba078, 0x1aed0f2e, 0x7316a952, 0xaafbeb0a, 0xe8796b31, 0xd8c14e7a, 0xbeced982} },
        { { 0xc967e9dd, 0xdceba486, 0xd7e0115e, 0x855691b4, 0x8da9158f, 0xa45fc1c2, 0xa2236db2, 0x012f98e5} },
        { { 0x126a99a2, 0x0030b275, 0xacd0a7bb, 0xbe2ddad0, 0xfd24f222, 0x87be5d77, 0x8f9c0f9c, 0xa5532e0f} },
        { { 0x956243f4, 0x5cf3a743, 0xdbb62c68, 0xcde0e0af, 0xb0ccf365, 0x180de704, 0xd36f4be1, 0xd0b3fee9} },
        { { 0x775cf4a9, 0x8324a3e5, 0xa97049b9, 0x84f5952e, 0xd2c45b93, 0x18cecf5d, 0xb757100c, 0xf57c936d} },
        { { 0x4e0645bc, 0x5b3c83ef, 0x8c167e35, 0xd31620b9, 0xa7edaff5, 0x3f4f39a5, 0x03c859ff, 0x63f3c390} },
        { { 0x6ced0638, 0x0e1f075c, 0xfd8a7e36, 0xbcd4a608, 0x38183e25, 0x7a3592ed, 0xa96006cd, 0xda1cff69} },
        { { 0xfdbe35fb, 0xed5b0b2b, 0x956b413f, 0x13186db5, 0x2b967f68, 0x42575b31, 0xf90ac6c0, 0x1e85a08a} },
        { { 0x9de736e5, 0xff81ee59, 0xeaf98ceb, 0x5adfe2a9, 0xbc2d8a15, 0x4911da06, 0xec1cfcb2, 0x144b9c3d} },
        { { 0x81ef9c72, 0x552a9e2f, 0x061c6dcb, 0xf9550aae, 0x376c6656, 0x1028fd2e, 0xc2b48682, 0x6ea1c785} },
        { { 0xe47e997c, 0x088057bc, 0x6aefd899, 0x7f71cd1f, 0x9e8e9a63, 0xa2564a5b, 0x4f1604cc, 0xbda08e9f} },
    } };
    uint32_t adrs[8] = {
        0x00000000, 0x00000000, 0x00000000, 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    };
    const XmssNativeValue256 seed = { {
        0xeb92ca6d, 0x924dba5b, 0xf2b41b95, 0xcad49aff, 0xf15b2b54, 0x2be92457, 0xc3c241b8, 0x56274d91,
    } };
    const XmssNativeValue256 expected_output = { {
        0xd934c1a1, 0x429fe488, 0xcbd83b30, 0x0d4314d5, 0xdb9d8c32, 0x2d138d1f, 0x04ef7e21, 0x4ea5dc29,
    } };

    XmssNativeValue256 output = {0};

    xmss_ltree(HASH_ABSTRACTION(&shake256_256_xmss_hashes) &output, &public_key, (ADRS*)adrs, &seed);

    const bool success = memcmp(&output, &expected_output, sizeof(XmssNativeValue256)) == 0;
    printf("rand hash function test %s for SHAKE256_256!\n", success ? "succeeded" : "failed");
    if (!success) {
        print_output(&output, &expected_output);
    }

    return success;
}
#endif /* XMSS_ENABLE_SHAKE256_256 */


int main()
{
    bool success = true;
#if XMSS_ENABLE_SHA256
    success &= test_rand_hash_with_sha256();
#endif
#if XMSS_ENABLE_SHAKE256_256
    success &= test_rand_hash_with_shake256_256();
#endif
    return success ? EXIT_SUCCESS : EXIT_FAILURE;
}
