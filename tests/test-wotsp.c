/*
 * SPDX-FileCopyrightText: 2023 Fox Crypto B.V.
 * SPDX-License-Identifier: MIT
 *
 * SPDX-FileContributor: Max Fillinger
 */

#include <stdbool.h>
#include <stdint.h>
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

#include "config.h"
#include "wotsp.h"

#include "private.h"
#include "signing.h"

#if XMSS_ENABLE_SHA256
static bool test_pubkey_gen_sha256(void)
{

    const XmssNativeValue256 secret_seed = { { 0x01000000 } };
    const XmssNativeValue256 public_seed = { { 0x02000000 } };
    WotspPublicKey public_key;

    /* Expected output calculated with Frans' C# implementation: github.com/dorssel/dotnet-xmss. */
    const uint32_t expected_public_key[][8] = {
        { 0x3bd0d8c5, 0xe06330d6, 0xeb21723e, 0x2fccb019, 0x3e357011, 0x2bb24591, 0x4c3d17e3, 0x4b664416 },
        { 0x90439291, 0x1e73d4b1, 0x0f7362d8, 0xa30df5da, 0xcf81ecfe, 0x4c59b2ba, 0x8db0e302, 0xa9c7ab0d },
        { 0x8e60c21d, 0x22a9451e, 0xc1cc1b06, 0xd05a9c24, 0x182445d9, 0x78e38bc0, 0x17f86caa, 0xa0cb3971 },
        { 0xf2dcc41c, 0xec255ac8, 0x1067c4ab, 0x2db782c8, 0x2f70bc2a, 0xc64b4368, 0x4460d521, 0xc1f80532 },
        { 0x6a61801a, 0xae1652d4, 0x7a55ec19, 0x1c0e7278, 0x8363fefb, 0x3f064335, 0x1c4c3db4, 0x56809e85 },
        { 0x12e4fd88, 0x42115439, 0x854c5610, 0xa057d270, 0xf574a5c8, 0x8dd14d35, 0xa4a36fd5, 0xaffd9733 },
        { 0x93a750f8, 0xe5865578, 0x80703582, 0x11401fc2, 0xe4443c7d, 0x68beba28, 0x32f12457, 0xeb287588 },
        { 0x73e5e7a4, 0x2c437345, 0x309b9a10, 0xfbc76b8e, 0x33aea271, 0x9531cd7c, 0xebe405f7, 0x307b1a7f },
        { 0x3d5131dc, 0xd2bfa0df, 0x8cf72dd8, 0x755492e8, 0xf81d2b24, 0xc9f0b26f, 0xa003dde7, 0x12f2efa0 },
        { 0x8ba902f9, 0xe2820898, 0x3c8ecc9c, 0x75a5acf1, 0xcf9df9d0, 0x57393cbd, 0xf191c52e, 0x77209e50 },
        { 0xae48c6ac, 0xe6cf1e1a, 0xd5c6c3b9, 0xd66b22e5, 0xf02696a2, 0x86217c5f, 0x76eb1406, 0x5cf56158 },
        { 0x4a6b743a, 0x3319ac85, 0x7c2d71b4, 0x7c625e27, 0x51b052fe, 0xd53a218e, 0xa2fb1955, 0x2a2bc614 },
        { 0x5a600647, 0x8a002d97, 0xaa092671, 0x6016fb8f, 0x12687a7b, 0x04ba7daa, 0x87e0e9ef, 0xe89dd4bd },
        { 0xd97eab9f, 0xc910b60f, 0x0865344d, 0x7efc8413, 0xc6c78045, 0x4e4416f4, 0x7127b075, 0xf639d16e },
        { 0x2b7b777f, 0x5dc6f754, 0xcc04b216, 0xb41c2e5e, 0x8d498e9a, 0x8afbb58b, 0x9db25d44, 0x1b67e830 },
        { 0x567be2ac, 0xd552df78, 0x7f2accaf, 0xb8215df1, 0x9debf985, 0x8763457c, 0x42c54767, 0x1eb43a5b },
        { 0xc2f9ce1c, 0x885c8f0e, 0x4e7eb3c8, 0x2baafcb1, 0xa5f0ae9b, 0xcfed7a85, 0x83c6981a, 0xb1237955 },
        { 0xa837f8f2, 0xa07f055a, 0x6bc8e2f6, 0x44ee0f11, 0xfeca2574, 0x4a51ae91, 0xafa1cea7, 0xb8c66462 },
        { 0xbcbbd117, 0x19cb9dc1, 0x63866429, 0x4b4b78a1, 0x28d67b70, 0xf7c8aeee, 0xcb1c6310, 0xe52d9ec4 },
        { 0xc2d38057, 0x945071a5, 0xcc593241, 0x50125ee3, 0x3cf7de06, 0xe9efbcc4, 0x4fded088, 0x624da221 },
        { 0xae24da2a, 0x046ecc15, 0xdcd40cdc, 0xb0e90974, 0xd4c27435, 0x2d1b27b4, 0x1219083a, 0xe41e4bbb },
        { 0x775b348c, 0xda5a6b0e, 0xb2c29aeb, 0x0de8473e, 0x228dbee6, 0xf5ce46a3, 0x98ccf12a, 0xec7beebd },
        { 0x4214bfc2, 0x75b998ff, 0x56a2003c, 0xf7bd1da8, 0x31644e03, 0x00f1ca62, 0xccb31834, 0x52482bd4 },
        { 0x803f3880, 0xdf1189e1, 0x57c9aba6, 0xe1260863, 0x63d07843, 0xb81c680b, 0x31a2c588, 0x02100f40 },
        { 0x176a448f, 0x08817ff3, 0x640286f3, 0xca7bfcb0, 0xb99b4c00, 0xef7116c0, 0x307693bd, 0x84dd28e4 },
        { 0x18ef1ef9, 0x11ddb8e4, 0x058ab478, 0xa10e4a3d, 0x234f889b, 0xf157de56, 0x368b2031, 0x0adc0700 },
        { 0x43b998d1, 0x51da32dc, 0x10c90984, 0x89661656, 0xc6bf0ed8, 0x518cef3e, 0xf158839d, 0x165e8b2b },
        { 0x2e5bd977, 0xb5951ffe, 0x069c1a3c, 0x87dce216, 0xb01cb8cf, 0x5ad7928f, 0xda6f8657, 0x566b23f5 },
        { 0x4d4c7526, 0xcb45f42b, 0x12356730, 0x7a2347e0, 0xdd429370, 0xfed4cc0f, 0xb3864fe3, 0x4c49240b },
        { 0x6fcdeeeb, 0x749d64a3, 0xefa9bcb7, 0x2bfd9bcf, 0xc0e9d498, 0x321a7792, 0x4ef717c4, 0xf3796dd4 },
        { 0x190ea378, 0xb1bf148d, 0xf7acc6eb, 0xf3a67a2a, 0x6f623758, 0x2d407e37, 0xb1c5d8a0, 0x22a38803 },
        { 0x682d4182, 0xcd852793, 0xebd59f77, 0x8b8b790c, 0x11cc3f06, 0xd81e427d, 0x1b610f98, 0x60ef6cca },
        { 0xb9e87a11, 0x3afd6f0a, 0x3b5fc6fe, 0x6b5e483e, 0xcc73cf68, 0x0f74335a, 0x92b0bf9f, 0x8e185be2 },
        { 0x24919953, 0x24c16f66, 0xc7647ade, 0x109acea7, 0xbe50454c, 0x2090be98, 0xe6906127, 0x37bc4da0 },
        { 0xfa085ae9, 0x75f0f8b6, 0x3a2d17c2, 0xd012a120, 0x4febf340, 0x333ba1b0, 0xd80b89a3, 0x10c1bee1 },
        { 0x8d1a4722, 0x69720084, 0xbeaaafd5, 0x7d42f37e, 0xd4be41ef, 0x477c3065, 0x4eefd3b4, 0x1b0b7d53 },
        { 0xf7c6a93d, 0x9f7bd8ba, 0x8f6bb635, 0xcb189dbb, 0xa498ba63, 0xbea387b3, 0xf7586e7b, 0x75119635 },
        { 0x5c91bc35, 0x40beab8d, 0x5f30b3a3, 0xf113ca7a, 0xcec41338, 0xa664d252, 0x20b3f56d, 0xa9b5ea45 },
        { 0x28aa1075, 0x5024ad22, 0x73156ba5, 0xa4eda592, 0x65a90d9c, 0x61fa3066, 0x14ba88d0, 0xdc884cdf },
        { 0x367db1ab, 0x3c2c1190, 0x542c1f12, 0xac79345f, 0x604f2af1, 0xe999764f, 0x85ae51ed, 0xdc59c7c7 },
        { 0x62eefe75, 0x69f5242b, 0x64693401, 0x226eb815, 0x6a69211e, 0x5865c89b, 0x2a2045d4, 0x4657bf68 },
        { 0x150048fc, 0x40f8149a, 0xfec66265, 0x6e2e96af, 0x273a81d1, 0x4197ac8d, 0x72ddffd4, 0xf7d439a5 },
        { 0x56f00588, 0x3f09b80b, 0xbd54a1ec, 0x5e54884f, 0x1191df56, 0x68163352, 0xf5ebcce3, 0x14507030 },
        { 0xefbfb97b, 0xd63282ad, 0x8f70f77f, 0x5bb106c2, 0x7a517455, 0x150d7aee, 0xaea244fc, 0xa347cbcb },
        { 0x36dd20fa, 0xa8c5b8fb, 0xf15d4a9c, 0x164e8fed, 0x35ab5fe8, 0xf170b56b, 0xb6f66b79, 0xabb9929a },
        { 0x6830a518, 0xb04e9750, 0x8277fae3, 0x391f7341, 0xa0a9395c, 0x1d5d5ee5, 0x1f73b0ec, 0xc30a4ca9 },
        { 0x1b0ab9e8, 0xf9219c07, 0x82b758a0, 0xf0beacf4, 0x854dadd5, 0xcad89ba8, 0xeb648faa, 0x5bdad056 },
        { 0xb5d966ab, 0x7df58363, 0xafa3b01f, 0xd56d2183, 0xd0ee5be6, 0xa4703355, 0x37086441, 0x092c0112 },
        { 0xc3e1ddaa, 0x5a1e4281, 0xae13b191, 0xfa422426, 0x086ef5a6, 0xc3c6e87d, 0x2763b7f6, 0x1c8ac465 },
        { 0x7871139d, 0xe1eabf45, 0x5c40afe0, 0x5e31c5fd, 0x3f9e9911, 0xed277a0c, 0xe9cc6887, 0x930e93f1 },
        { 0x359f4ef3, 0xb9a669e9, 0xe59161e0, 0xe94a1117, 0x52495e14, 0x0aae8370, 0x77ea07fd, 0x213a8f35 },
        { 0x8b533732, 0xb142f160, 0x670554d9, 0xa6dd4b2b, 0x4be31d97, 0x0be0a6be, 0xbd1aea8f, 0xf079494c },
        { 0x8cd4186e, 0xb494bf9f, 0x9ea65600, 0x540ba504, 0x63362412, 0x28604937, 0xde729102, 0xd2a725b2 },
        { 0x43ac74da, 0x32e195e9, 0x35a85ed5, 0xd8d2b327, 0x542e937f, 0x6964fea1, 0x93d31ff1, 0x72b5adc4 },
        { 0x87b72719, 0x8ec3454b, 0x09ab62fb, 0x0acb10eb, 0xde001946, 0xd6d40350, 0x583108a5, 0xe58c4476 },
        { 0x49f82182, 0x5fe02a78, 0x04f045e0, 0x61ec2f3b, 0x8d457479, 0xe11fab40, 0xb62ef1bb, 0x72dc539d },
        { 0x91fcf230, 0x9ad52931, 0x06fde67f, 0x6eaa2573, 0x7774de56, 0x61d98304, 0xef712362, 0xbced61b6 },
        { 0x8261d217, 0xfe4e131b, 0x08052465, 0xc4390db0, 0x6f04d7ca, 0x08a7b2ce, 0xe69a3cef, 0xf489c0c8 },
        { 0x9adc9e8b, 0x4d287e79, 0xb2985a90, 0x5832cf4e, 0xfd6ec8a5, 0x79d64a2f, 0x8443d88f, 0x535ddcc1 },
        { 0x1c506aa1, 0xf4b652e6, 0xaaaecd36, 0x5fb00377, 0xbae99ea4, 0x935a21a8, 0x779deed6, 0xa28b1bd3 },
        { 0xc3a72a73, 0x9119f76f, 0x9f3a529b, 0xf12b7969, 0xcc13ab3e, 0x71bbef3f, 0x48dcf2f1, 0x464d15e6 },
        { 0xf7ec29da, 0xc9494f51, 0xe2d11b5c, 0x419638e8, 0xdcc6b823, 0xd9f4fd70, 0x24ed9f92, 0xfa80daff },
        { 0x2988fcfd, 0x484c224c, 0xd73267b2, 0x38dc7e2b, 0x07a057fd, 0xe7d48fe1, 0xda803055, 0x7add024f },
        { 0xda563afd, 0xced30e2b, 0x8151ec61, 0x4fbb7497, 0xa68a5c78, 0x65316fbf, 0x58c186a4, 0x3b8c08a8 },
        { 0x99a21cfd, 0x08273bfb, 0xcb400ed4, 0x0b9bfef1, 0xf4d02255, 0x8f2673e5, 0x673a98ba, 0xcda1fef1 },
        { 0xe378a141, 0x9f387638, 0x3fcde21b, 0xdff1ec57, 0x10c96c26, 0x79d2afd9, 0xfb5a1e14, 0x06d8f6f4 },
        { 0x5737aad9, 0x6b09b298, 0x56cdc113, 0xa93e43de, 0x90f9937f, 0xea403b82, 0x2cfd36de, 0x3a3d2246 }
    };

    XmssSigningContext *context = NULL;
    XmssError err = xmss_context_initialize(&context, XMSS_PARAM_SHA2_10_256, realloc, free, NULL);
    if (err != XMSS_OKAY) {
        printf("Failed to initialize signing context for SHA256.\n");
        return false;
    }

    wotsp_gen_public_key(context, &public_key, &secret_seed, &public_seed, 0);

    bool success = memcmp(expected_public_key, &public_key, sizeof(WotspPublicKey)) == 0;
    printf("Public WOTS+ key generation test for SHA256 %s.\n", success ? "succeeded" : "failed");

    return success;
}

static bool test_sign_sha256(void)
{
    const XmssNativeValue256 message_digest = { {
        0x01020304, 0x05060708, 0x090a0b0c, 0x0d0e0f10, 0x11121314, 0x15161718, 0x191a1b1c, 0x1d1e1f20
    } };
    const XmssNativeValue256 secret_seed = { { 0x01000000 } };
    const XmssNativeValue256 public_seed = { { 0x02000000 } };
    WotspSignature signature;

    /* Expected output calculated with Frans' C# implementation: github.com/dorssel/dotnet-xmss. */
    const uint32_t expected_signature[][8] = {
        { 0x9ae70fa6, 0xee655358, 0xd2ccd6f3, 0x809f3301, 0xcc8e1e4d, 0x63998e90, 0x3f3ab7ad, 0xe5b32578 },
        { 0xa7ac7805, 0x92490bef, 0xd489fd0c, 0x0e0214bc, 0xe441d572, 0x5ecd80c9, 0x44929599, 0xd2a77d1f },
        { 0xf6db56c4, 0xd96bb72b, 0xc4fd5518, 0x29904340, 0xe90521e4, 0xdb1c42f8, 0x0f39b78a, 0xc1ba5341 },
        { 0x70543529, 0xf6117131, 0x055e0077, 0xf7abe24f, 0xf5a87ed2, 0xad70d2ae, 0xf8677709, 0xc7dc1e4f },
        { 0xad5752a9, 0x290f2b8c, 0x8b6ccc8c, 0x3e56026c, 0x4584bbfe, 0x5a08e79b, 0x8d127abd, 0x925f900b },
        { 0x93dd7dde, 0x40373d0b, 0x9be1b9c7, 0x29e82bdf, 0xc12237b5, 0xfff428b9, 0x639d33e1, 0x876c2a45 },
        { 0x9d0955b5, 0x0510b8aa, 0x88c0da6e, 0xa323d915, 0xd76ad1c1, 0xf5cfff33, 0x4e7b4be2, 0x9b96e97f },
        { 0xc61d0e1b, 0x92553069, 0xf43ee9b4, 0x2eb5533a, 0x2bb70fe6, 0x5033a446, 0x9cc338cf, 0x28781290 },
        { 0x66909e21, 0x6d0878d4, 0xa4a31e9d, 0x7357defd, 0xcd90e5fe, 0x751617ef, 0x0ad90b1a, 0xcef37ae1 },
        { 0xa12084d6, 0x46e5cd99, 0xa4a9f1a9, 0xeb5e0b82, 0x73ed130a, 0xba998774, 0xa135fa42, 0xe4a7745f },
        { 0x458007eb, 0x0def9613, 0xb33a2e88, 0x5a6077c8, 0x8cb96bab, 0x550c329c, 0x947e0737, 0x4c227622 },
        { 0x467d0f38, 0x338f0af4, 0xa6760f1a, 0x9d74a644, 0x592b486f, 0x3d2c83e8, 0xd317d5fa, 0x68bea2bb },
        { 0xae329235, 0x73eb8f45, 0x925e90a0, 0x21dbe23a, 0xbc494a21, 0x3093b854, 0x70bd4d89, 0x66933910 },
        { 0x94fe7c27, 0xffa6dcfd, 0x10d5ce26, 0x7755f8c6, 0x3cbbe9c6, 0xffe90cdd, 0x29161297, 0x679db4e2 },
        { 0x923eb005, 0x60609b3c, 0xca575f93, 0x4db6ef3e, 0x85b51c27, 0xe761070a, 0xc2666cd5, 0x4cf07fbf },
        { 0x9797ce0e, 0x8c44b28a, 0xc260d063, 0x1b7420cc, 0x0899eb17, 0x84282d1e, 0x37a523e2, 0x3430f918 },
        { 0xd2892f84, 0x96db7182, 0xe0469376, 0x21201adc, 0x862d262e, 0x8a9dc2a0, 0xe485b363, 0x5b8bf694 },
        { 0x8cdfae6c, 0x76b8fd02, 0xfa3d1b14, 0x654b4b38, 0xdf3897f0, 0xf727126e, 0x7564aa3c, 0xb6ca8547 },
        { 0xe02cacee, 0x8bab3ecf, 0x3fcc8182, 0xdecdfb57, 0x53291325, 0x84a585fd, 0x0d67608b, 0x205feb20 },
        { 0xaf01c003, 0x0faafb6a, 0x8144fdaa, 0x48ddc625, 0x8497955f, 0x1e21aba6, 0xfc2d854d, 0xd9c4b7a9 },
        { 0xa044d961, 0x11d82e66, 0x98b894d7, 0x3a0d4129, 0xc207cd4e, 0xaff3d24a, 0x1797f6df, 0xe667aeed },
        { 0x60a3d8f1, 0x1196cc80, 0xf3d387e8, 0x6413a9cc, 0xfbe02365, 0x8b762d21, 0xe501be31, 0xbac0ee19 },
        { 0xe24c2ffb, 0x75c5362e, 0xd6b422ee, 0x02793167, 0x0500acdc, 0xfaba2703, 0x5de21d0d, 0xce2caf84 },
        { 0x37479262, 0x9aba9850, 0xdaa38031, 0x100358a9, 0xe6465a7c, 0x64309e0f, 0x510dc32a, 0xe812b5e9 },
        { 0x2a753272, 0xaf6427b1, 0xbdaee49a, 0xad2eb06c, 0x5bb8b782, 0x5389fe7a, 0xd8a567e9, 0x2e005b3b },
        { 0xcef4d386, 0x77977372, 0xb90a895c, 0x74c64d60, 0x498053db, 0xde1d13f4, 0xe51d7090, 0xa0613632 },
        { 0xab05ae13, 0xe8f8aab2, 0xe5185090, 0x7fb1f8f6, 0xdb2c72ca, 0x4fa83ae6, 0x36e1e987, 0x9fc2c7f7 },
        { 0xb3d597ab, 0x09ab12dd, 0x5430b280, 0x3a238870, 0x16c1335c, 0x0a8bb967, 0x2df0e4b5, 0x0f9c1885 },
        { 0xe2041351, 0x3572c3ea, 0xb2830247, 0x4c9cc65d, 0x8eb616dd, 0x4db75028, 0xeddec08f, 0x0dda9428 },
        { 0x6fcdeeeb, 0x749d64a3, 0xefa9bcb7, 0x2bfd9bcf, 0xc0e9d498, 0x321a7792, 0x4ef717c4, 0xf3796dd4 },
        { 0x0bbcfeb8, 0xed0498fb, 0x5fcaa852, 0x1366a686, 0x4761f6b5, 0xb7215569, 0xcfd4607d, 0x19906655 },
        { 0x0edf1feb, 0x0ed835ef, 0xec12c8de, 0x9df107b9, 0x2613e0d9, 0x2c783ce3, 0x5bc5daf8, 0x0eb12355 },
        { 0x3d6cd1d8, 0xef06e3ee, 0xbf85dda3, 0x277c9a2f, 0x1bf7238e, 0xa688c9f8, 0x55713787, 0x736fff56 },
        { 0xdefee581, 0xb7f25e3e, 0x454a2be4, 0x47aae251, 0xb99cd515, 0x48b14d28, 0xb4629412, 0xbe75e81f },
        { 0xe2f65a74, 0xd463284c, 0xbc9d0d9e, 0x6fce61ea, 0xba12b7fb, 0xaeef6bcf, 0xfe9d4765, 0xab201ef2 },
        { 0xe73116d5, 0xf1a31287, 0x98eed73f, 0xdc30ca5d, 0xe51c8c48, 0x735e5c3e, 0xf3c19468, 0xb2a1d76a },
        { 0x1f83156f, 0xc16edb30, 0x02d079d3, 0xb6529cdf, 0x98b0990d, 0xfb8be7a5, 0x60576e80, 0xff598fc2 },
        { 0x71c27f13, 0x5863b6ed, 0x3122ddc6, 0x70d141fa, 0x0657dcc7, 0xece36cb7, 0x5ac324c0, 0xd7eaa1e2 },
        { 0x2c3afc9c, 0xcdd47fd5, 0x2a1e9896, 0x726b7ded, 0xeb31b91b, 0x3695b09b, 0xb7eb6239, 0x0a238d19 },
        { 0xdd31addd, 0xdeebdfc0, 0x2652e99c, 0xfa2fff9f, 0xfc5ca8c7, 0x21a60364, 0xbc494ad5, 0x38dc98c9 },
        { 0xffd63849, 0x9412a693, 0x993f91a4, 0x75574a00, 0x23d1616a, 0x5e3f9f2a, 0xb52ed853, 0x111425f1 },
        { 0x8dfb4ddb, 0xc56dbc33, 0xc15171d2, 0xb90c9ec6, 0x533a587f, 0xd8c0ff03, 0xa7a5d1a4, 0xd7415609 },
        { 0xb237c592, 0xab8954ca, 0x9df32094, 0xd93e89b3, 0x06667b52, 0xfa871450, 0x5ecec084, 0x92bcf683 },
        { 0x4f125b68, 0x5538f08b, 0x556ef1d5, 0xe1f98d43, 0x82e9d01a, 0xe4f4bbc7, 0x52a2abc3, 0x6f8ae006 },
        { 0x595e585b, 0x64446607, 0xc8427984, 0x4c032a22, 0xe5de5295, 0xd703d01f, 0x11f37042, 0x3715b6cc },
        { 0x9d36a158, 0xc80c630a, 0x63155352, 0x49458701, 0x1731923a, 0x6ad39456, 0x10abcc7a, 0x3e46d9a8 },
        { 0x9c23a341, 0x039c5690, 0xa6053e6e, 0x680866f3, 0xd55127e1, 0x018cedb6, 0x15e4a41a, 0x9e828cfb },
        { 0x80355ce7, 0xf5a47f9e, 0xc74d1098, 0xfb8ef775, 0xca174798, 0x7148a6a6, 0x72a5cd9f, 0x5d43369d },
        { 0xded95b27, 0xe01f92f8, 0x9e5efc2f, 0xba112550, 0x7d22e436, 0x955c974a, 0xfa59293c, 0x5c3f2d9e },
        { 0x16d3a2b6, 0x01b17311, 0xb0386f61, 0x3506134c, 0xdcd5af09, 0x0f8de473, 0x161f4614, 0x7d40f7ec },
        { 0x82b52313, 0xec4dfa83, 0xe54ca6bc, 0x73de15db, 0x2453be03, 0x89f18cdc, 0x9318f375, 0x72f5b2a9 },
        { 0x85d96978, 0x4c108d25, 0x4f91ce8d, 0xf5ca37ab, 0xeae23d47, 0xb24f8e7e, 0x96e6a13d, 0x6d89dac8 },
        { 0x2e271c39, 0x0358306d, 0xddd58759, 0x70a1b87d, 0xf976df0a, 0x2dc93eb3, 0xf2c9a9f7, 0xc6d37ee8 },
        { 0xea96ba6e, 0x07da4c41, 0x791e7319, 0xb82fe2cf, 0x42d059f4, 0x4aac4c88, 0x5c13dd73, 0xcd87eb6e },
        { 0x2ccb9c33, 0xe5f17748, 0x53fec640, 0xe188d6b0, 0x614ee433, 0xa612c878, 0x84d3acdb, 0xa967ef36 },
        { 0x1d060f4b, 0x2bcfe6cd, 0x2032dde7, 0x1a282cad, 0xcc48fab8, 0x79ec8584, 0x079d01d9, 0x9fb87c00 },
        { 0x7793d286, 0x7ba3d626, 0x6e1422c1, 0x3b61650e, 0x2019ae64, 0x41210b2b, 0xd9366963, 0xeecb9c5d },
        { 0x79864785, 0x4848f413, 0xb8f7ce9c, 0xcd62da89, 0x89229164, 0x645cbff5, 0x74fe3a06, 0xcde754b8 },
        { 0x5e84369e, 0x3c8ded7f, 0xc6e16122, 0x88aa028f, 0x0f6ceb89, 0xfc01e285, 0x42c1e44e, 0xaa1a57ed },
        { 0x7238bf8a, 0x65774bde, 0x67d34ff3, 0xd1751279, 0x215a77ff, 0xb659fdd5, 0x3ae08271, 0x448eb457 },
        { 0x3bb3f544, 0x64f4053a, 0xd2c2f48d, 0xcc966541, 0xb4206024, 0xb816448f, 0x3d29d1f9, 0x6c7192c9 },
        { 0xf7ec29da, 0xc9494f51, 0xe2d11b5c, 0x419638e8, 0xdcc6b823, 0xd9f4fd70, 0x24ed9f92, 0xfa80daff },
        { 0x44797246, 0x143d96ca, 0xb03b5e08, 0x791b0be4, 0xd7214340, 0x43403841, 0x15f5cbb1, 0x3c073aca },
        { 0xbae992dd, 0xf4e6ed19, 0xc5531654, 0x99715fe3, 0xf2dc0162, 0x55574e1c, 0x84c52a18, 0x29b42208 },
        { 0x974ef472, 0x2150ee6c, 0x7e6e35f9, 0xb047ce28, 0x1d70a12e, 0xd8bb0e0b, 0xff73e695, 0x0746e43c },
        { 0xc7f45af1, 0x47e57763, 0xd67cf08f, 0xa3290586, 0x76deceb6, 0xca7c6db0, 0xcda4454d, 0x94ae9a0b },
        { 0x436bc962, 0xe4a59668, 0x557a3723, 0x28a5a4f8, 0x2032853b, 0x2a6b3c1b, 0xbf81cd74, 0x1004d627 }
    };

    XmssSigningContext *context = NULL;
    XmssError err = xmss_context_initialize(&context, XMSS_PARAM_SHA2_10_256, realloc, free, NULL);
    if (err != XMSS_OKAY) {
        printf("Failed to initialize signing context for SHA256.\n");
        return false;
    }

    wotsp_sign(context, &signature, &message_digest, &secret_seed, &public_seed, 0);

    bool success = memcmp(expected_signature, &signature, sizeof(WotspSignature)) == 0;
    printf("WOTS+ signing test for SHA256 %s.\n", success ? "succeeded" : "failed");

    return success;
}
#endif /* XMSS_ENABLE_SHA256 */

#if XMSS_ENABLE_SHAKE256_256
static bool test_pubkey_gen_shake256_256(void)
{
    const XmssNativeValue256 secret_seed = { { 0x01000000 } };
    const XmssNativeValue256 public_seed = { { 0x02000000 } };

    /* Expected output calculated with Frans' C# implementation: github.com/dorssel/dotnet-xmss. */
    const uint32_t expected_public_key[][8] = {
        { 0xe6666420, 0xfb16bd0d, 0xf73aca68, 0x1f1ad8bc, 0x0a21cf5e, 0xf38638a8, 0xc3fe81ae, 0x12aefcd1 },
        { 0xb6e4c778, 0xc6d7a41d, 0xc899bf56, 0x61922077, 0x842cbeb9, 0x966a5c4c, 0x789c94b1, 0x52b07b22 },
        { 0xd86c9e0c, 0xfcb4d1ec, 0xdc47ce9c, 0x60a03583, 0x6a679fde, 0x7460b248, 0x2ba4833d, 0xaea2a89f },
        { 0x75a64278, 0x105530d2, 0xd92a38d9, 0xc261cc27, 0xd095b851, 0x96eee999, 0x4f56bbf2, 0xe660ffdb },
        { 0x673b3209, 0xb329392c, 0xde2ed231, 0x8153570f, 0xa309ad40, 0x8daea034, 0x76c91e0a, 0x9562af0a },
        { 0x28a31ae7, 0xd1aa2924, 0xb16cd58e, 0x05e8030e, 0x81e94c1e, 0x8e90806f, 0x2e417ee1, 0xa50e7a6e },
        { 0xed1d860c, 0x1ccaabfe, 0xb55a6444, 0x4dd6e14e, 0xb08f9690, 0x46b1667d, 0x99b4e5a7, 0xa7365e69 },
        { 0xe9b8e7f6, 0x1abf802f, 0xabeef6af, 0x560d059b, 0x5fe55ee4, 0x25024360, 0x3607588e, 0x4e255640 },
        { 0x63128ba3, 0x80d0507e, 0xeca6d8d5, 0x2b076443, 0x4acbe3e6, 0x0e68aa8d, 0xe8060138, 0xdaf58f4d },
        { 0x61d7f2a7, 0xd812e8c2, 0xdf92d758, 0xebc6fc34, 0x9b545d11, 0xbfbee98e, 0x8d1d9417, 0x33e2350b },
        { 0x9a0b4c94, 0xda9e1b5e, 0x91bf5fd4, 0xa5124ae0, 0xdaccaa3f, 0xecc1845f, 0xd933939c, 0xca1d6b8c },
        { 0x28183629, 0x295ab979, 0xde2b0e68, 0x7b5b0fc3, 0xd8bab536, 0x0c5daabc, 0xc6803355, 0x1f8b4a4f },
        { 0x9b720faf, 0x9f70db83, 0xaca0f2c8, 0x2f5dc99c, 0x2edd5fc9, 0x26333099, 0x045bacfe, 0x44448257 },
        { 0x8404c33a, 0x385fb936, 0x4137b5c9, 0xc3dbc4de, 0xaf6c8693, 0x23bd35ce, 0xc554e72c, 0xb9c20b30 },
        { 0x123dcf10, 0x1a99a9b1, 0x9c78ee28, 0x2972db03, 0x7f4d4dfe, 0xad12e25c, 0xdba1d444, 0xe57b2628 },
        { 0x6a2216d6, 0xf71c00e9, 0xf3fa7c62, 0xeec80656, 0xa897d810, 0xa9541070, 0x8fd676be, 0x75374e4e },
        { 0x635b38a2, 0x0c8e9d5a, 0x711d0abe, 0x1f4f0507, 0xca30c3ea, 0xe3b75f9e, 0x2f4939a0, 0x7c13f659 },
        { 0xb01f2b90, 0xe2ced0e7, 0x0631d8a0, 0x0e5049db, 0x24e85ca8, 0x2b942d5b, 0x0ac70d6b, 0x9aaf665a },
        { 0x99da15f1, 0x5cd0bc83, 0xb6992c26, 0x09b7e6e8, 0x10c9232b, 0x1034f6ed, 0xba0db540, 0x8d0b4c5b },
        { 0x611395d7, 0x41089667, 0xd8191b4e, 0x1c87b6d1, 0xe86010d7, 0xf2de8b3b, 0x3a7535b9, 0xca4917a4 },
        { 0xa4a875f1, 0x7363353d, 0x1d3cb25b, 0x5b46f120, 0xfb910b71, 0x7dd1be2c, 0xfdbe5f9f, 0xea0a1d5b },
        { 0x4a701de1, 0x42335fd0, 0xa30a19df, 0x804319f7, 0xd2a8b7e6, 0x68a3a1c9, 0x9fcb0b33, 0xc0b80699 },
        { 0xb2ad1ad3, 0xede29379, 0x50167819, 0xc4ed798b, 0xde1f2897, 0xb9462d5e, 0xaeeca454, 0x6b7b3262 },
        { 0x803db198, 0xf336a22d, 0x857b7c91, 0x7ebc4995, 0x8321b4d8, 0x63d53d1d, 0xc37eefff, 0x57cb9258 },
        { 0x28be8970, 0x8c9f66ee, 0x7f114205, 0xc91d3d1e, 0x85c31e26, 0x3bf58524, 0xa5f6331b, 0xfab6a1dd },
        { 0xd26b86af, 0x57c6df73, 0xa9c38eb7, 0xa52fe087, 0xb131012a, 0x4e517ef7, 0x2c439ed2, 0x1c0abde3 },
        { 0x34737e44, 0x2c9439ea, 0x7707d432, 0x7d1ead20, 0x6ef3e7cf, 0xc8dd9d84, 0xad0a63a7, 0xf279d719 },
        { 0x154e92fb, 0xca3d8118, 0x57cd2f2f, 0x330386e8, 0x4493038c, 0xa3ddc7d2, 0x7e5d9206, 0xcaffc38d },
        { 0x33aba580, 0x3d525ee3, 0xed5c26ba, 0xcdc2f595, 0x28789e7d, 0xdd637fd0, 0x8f9f5cc3, 0x07bf6729 },
        { 0xac88d5b1, 0xcc746be7, 0x4e570bb1, 0xabb5ea32, 0x129d9603, 0x5ae55a5d, 0x8468b663, 0xd12be04f },
        { 0x075341f0, 0xb0851f62, 0xbae507f9, 0x2bb26eaa, 0xd20f59e1, 0x8b5f96f0, 0xd05c850e, 0x4715d22e },
        { 0x075d38bd, 0x24f96087, 0xb7d743fb, 0x15f85a81, 0xa487ad86, 0xb7c10c1d, 0xc1b48780, 0xb8a2f5a2 },
        { 0xf6a734a8, 0x6bbc29cf, 0xa0a5c79d, 0x79404c92, 0x37260dc2, 0x6358d730, 0x227555fe, 0x36d24246 },
        { 0xd9ba48b4, 0x868dcd45, 0x0c703a21, 0x6603b179, 0x778db87a, 0x88c9dd57, 0x32af160e, 0x2f927d73 },
        { 0x42135153, 0x1fe4727b, 0x35777d8f, 0x3983a0c9, 0xed7e0b9b, 0xb8707085, 0x0e438ff9, 0x238c041c },
        { 0x3da35337, 0x7c8f655d, 0xb6382f0a, 0x8f8c09e1, 0x90e66b4d, 0x6354d464, 0xd4160a48, 0x73fd1d73 },
        { 0xdf24e347, 0xf58b13ac, 0x266ca393, 0x181bc988, 0xc02ec0f7, 0x9f654751, 0x2ded92ad, 0x3aa5fbbe },
        { 0x4c95954a, 0xa95ecaea, 0xa890d7ff, 0x4d8aada4, 0x462aa31a, 0x67f9a034, 0x36a74cab, 0x39e69e99 },
        { 0xc2687626, 0x511c99be, 0xa0c2196f, 0x7feac828, 0xdf194a4e, 0x02704884, 0xa8420b87, 0x16f3e22e },
        { 0x05f86715, 0xccc9a306, 0x1014e596, 0x39634db6, 0x7b98d246, 0x816685b3, 0x363cf85f, 0x0d6d76dd },
        { 0x0914fa64, 0x8a4d84ff, 0x400a83fb, 0x1782ec9b, 0x7b69d6b1, 0x3d0ce0c2, 0xc36af2c5, 0x29ca57fa },
        { 0xfd3d878e, 0x437205cf, 0x0715dd56, 0xfe83c29d, 0x1e8e4c23, 0xab6cffee, 0x44aecedb, 0x303f8f03 },
        { 0x07d54bb8, 0x9a07b232, 0x5c7742c7, 0x955e58ee, 0x9f04888c, 0xa384e95d, 0x0a4c9e6c, 0x5439e349 },
        { 0xa47fd38c, 0x000612d4, 0x13f6089d, 0x606578f4, 0x76144f45, 0x5d703d5f, 0xe92b201e, 0xb186dce3 },
        { 0xe00db1b1, 0x01a27f79, 0x899d1588, 0x1405ee68, 0x09742e44, 0x9b0bba50, 0x2ecf77e2, 0x6fc41528 },
        { 0x67ab962d, 0x585a2341, 0xc5f5de15, 0x870e3831, 0x49ddbde9, 0x40f450d5, 0xae9f65ed, 0xd4e9b2ef },
        { 0xf73fd183, 0x9f3f7bdb, 0x53fa6e6a, 0x2eb425ba, 0xc7cc7e9e, 0xf5001e82, 0xa82777d1, 0x9134f2b3 },
        { 0x246700b0, 0xe0a3e1bc, 0x3538d479, 0xe55c389b, 0xe1ff5f28, 0x335aaf90, 0xdef9748c, 0x1e42689f },
        { 0xe1c78b53, 0x4634ac94, 0xb46c1802, 0x4731743a, 0xd19f93cf, 0x7d675083, 0x89ebd7ec, 0xfabf56eb },
        { 0x8b930563, 0x12a198a1, 0x1f259f80, 0xc9651a77, 0xf28bc288, 0xe3f12aad, 0x92e3becf, 0xe7020b1c },
        { 0xab4691d6, 0x0544dbb2, 0x524d0e64, 0xfefa0a89, 0x8eea4a42, 0x7deeab99, 0xbc250ea4, 0x0f8d3444 },
        { 0xaf3a946a, 0x4f01df02, 0xd04ac7fe, 0xc60212be, 0x555ff8ec, 0x638ec013, 0xee9c5812, 0x7fcc5aa6 },
        { 0x61302ca9, 0x174ecd40, 0xc6f36749, 0xaef37259, 0xbd475abc, 0xa6d3ca19, 0x11dfa08a, 0xf19fbf3d },
        { 0x64f8f171, 0x4cb3f1fa, 0x1dfb7ea7, 0x5fd8c4ea, 0xe5c78158, 0x960def40, 0x4de32460, 0xf9c05fc5 },
        { 0xb966ed07, 0x8537c5e5, 0xfadc7fba, 0xd6729a1d, 0xe3142209, 0x5f783173, 0x94f2ccd6, 0x64d53fb7 },
        { 0x5d9792d4, 0xd8de9a5e, 0xb2398ed3, 0x3c5c77a7, 0x34bb8dd9, 0x5ca3eefc, 0x5613d2f8, 0x310b8088 },
        { 0x5729c550, 0x7662cf9d, 0x00680c86, 0xf01e8839, 0x8974d09e, 0x2d05a245, 0x7247ba9a, 0xdf553284 },
        { 0x4373f5ce, 0x49fcd7c3, 0xed5c7898, 0x693f04e1, 0x4e93be2b, 0xb45238a5, 0x70b42a62, 0xa5474e51 },
        { 0x7d9f5209, 0x64219862, 0x494a795e, 0xa42374e6, 0xe0d836c8, 0x279c3ab7, 0xa018fe45, 0xbc4efb2f },
        { 0xde37ea0e, 0x86b7ff52, 0x902771df, 0x8f4c798a, 0xc317dc20, 0x3193b970, 0x0cd70250, 0xebe7bd7a },
        { 0x246ba815, 0x50547095, 0x82fd7e4d, 0x60b1fe64, 0x59e196a7, 0x5005ee86, 0x72fbc8db, 0x24a3c248 },
        { 0xbfe0efba, 0xd36dc0c6, 0x01f13d5a, 0x7f53a23d, 0xd499bc54, 0xa66bd0bc, 0x17fa4d9f, 0x6eb5caf8 },
        { 0xf2f4015d, 0x1499b55c, 0xfc29dcd2, 0x547e54b2, 0x12ec8631, 0xc6131269, 0x2d7bf6f7, 0xf811de23 },
        { 0x50c280e2, 0x04996967, 0xb6993aa9, 0xdc060400, 0x8bd2aed6, 0x627084f8, 0xe0a25017, 0x8ba5353b },
        { 0xc0834c19, 0x147c0cc1, 0xe8bb154f, 0xd3668b65, 0xb14a846a, 0xe1e40294, 0x6a035d06, 0x1cbb3273 },
        { 0xf39964fb, 0x9062f392, 0xd00625fa, 0xfbfa770e, 0x753f469e, 0xb29e1bcc, 0x7240463e, 0x366a04e3 },
        { 0x49cd4fa6, 0xc1ef590f, 0x41556fe9, 0x5d5f8ff0, 0x69dc75a0, 0x2701a614, 0x0c03ea06, 0xa951e9f9 }
    };

    XmssSigningContext *context = NULL;
    XmssError err = xmss_context_initialize(&context, XMSS_PARAM_SHAKE256_10_256, realloc, free, NULL);
    if (err != XMSS_OKAY) {
        printf("Failed to initialize signing context for SHAKE256_256.\n");
        return false;
    }

    WotspPublicKey public_key;
    wotsp_gen_public_key(context, &public_key, &secret_seed, &public_seed, 0);

    bool success = memcmp(expected_public_key, &public_key, sizeof(WotspPublicKey)) == 0;
    printf("Public WOTS+ key generation test for SHAKE256_256 %s.\n", success ? "succeeded" : "failed");

    return success;
}

static bool test_sign_shake256_256(void)
{
    const XmssNativeValue256 message_digest = { {
        0x01020304, 0x05060708, 0x090a0b0c, 0x0d0e0f10, 0x11121314, 0x15161718, 0x191a1b1c, 0x1d1e1f20
    } };
    const XmssNativeValue256 secret_seed = { { 0x01000000 } };
    const XmssNativeValue256 public_seed = { { 0x02000000 } };
    WotspSignature signature;

    /* Expected output calculated with Frans' C# implementation: github.com/dorssel/dotnet-xmss. */
    const uint32_t expected_signature[][8] = {
        { 0xf40e1007, 0xe62721b5, 0xc6406f84, 0xafba98c2, 0x98dfefca, 0xc11de99a, 0x59309316, 0x752e88f8 },
        { 0x6cea4798, 0x09ecafba, 0x30c28cad, 0x59580653, 0xeb4dd7e6, 0x4c1938b2, 0x53bcd160, 0xe8e63057 },
        { 0xfdb58470, 0x57e86a2f, 0xf663db47, 0x390a6574, 0x6370c7f3, 0xd8e38068, 0x28518d31, 0xf6c66743 },
        { 0x92e305c5, 0xcbcd339e, 0x9b452160, 0xf173a72c, 0x3b63b9d5, 0x06878395, 0x8907771e, 0xcab93e0d },
        { 0x976ddaf1, 0x8ba48763, 0xa7308c6c, 0x56b13f52, 0xe1868a65, 0x7ad88bfd, 0xb80e1447, 0x931b24f4 },
        { 0x9bdfcb52, 0xee83bc9e, 0x60df3d32, 0x4cd3133c, 0xae08479f, 0x7873d243, 0x01eb196e, 0xf19a6adb },
        { 0x29139e4a, 0x697972cf, 0x0528dac9, 0x97bcfa51, 0x80e9af77, 0x826cbb4c, 0x997fdda3, 0xc4d82016 },
        { 0x0933eecb, 0xe1e328a1, 0xde4a74f7, 0x362e75de, 0xee31d1ac, 0x51674a2e, 0x946f5588, 0x088d530c },
        { 0xe262a31b, 0xd559191d, 0xd21944d7, 0xab61390d, 0xd566f542, 0xc5574495, 0xc5638adf, 0x7e53ee9b },
        { 0x5c1cf236, 0xdefd7b2e, 0x1a7d419e, 0xbf46f30a, 0xf1c338e7, 0x77661b7b, 0xeecdb490, 0xb412c817 },
        { 0xbae7f30f, 0xfde9f1c6, 0x2ac93dd3, 0xe6a0d01d, 0x8b8e9d48, 0x7238786c, 0xd0950522, 0x72dab961 },
        { 0x59f19457, 0xbf0abeab, 0x5e8a98b0, 0xf980f09e, 0x719615b7, 0xd0e13b91, 0xf6deed60, 0xe2d71bef },
        { 0xb9d419c3, 0x73e5242c, 0x7272a424, 0x29822ff8, 0xcfdbd9a1, 0xbf07357e, 0x95d4617b, 0x47e48098 },
        { 0x1a4e816d, 0x8aa60310, 0x31d1c502, 0x85884100, 0x971d5268, 0x41b23f41, 0xd2df8114, 0x9ef68e0f },
        { 0x565c8b5c, 0x85c0fe46, 0xed4e2ceb, 0x205eab0a, 0xabc4751a, 0x6e80a8d3, 0xd4540b88, 0xa66e73da },
        { 0xc5c59fab, 0x88f15197, 0x5acf45b6, 0x57d62780, 0x1b954837, 0x43cb67b4, 0x75899b37, 0xb95fb40e },
        { 0x8dad2b4f, 0x76768a41, 0x01254899, 0xb5ebe100, 0x97c29e73, 0xeebbc310, 0x6edd3d38, 0x3e80ac15 },
        { 0x315c21fb, 0xa35a1912, 0x2d7d73fb, 0x0539940c, 0x16d695d9, 0x9087b098, 0x9aec2ac6, 0x37b40b43 },
        { 0x13d7f864, 0x444e089d, 0xf6dfc6dc, 0xbcfd3e2b, 0x317b6aab, 0x774b9fc7, 0x6ed28f1f, 0xc3bb025d },
        { 0x3300dc05, 0xc45c9ae1, 0xf9e5e361, 0x22949301, 0x3bacb7d6, 0xdfeda364, 0xb4b415a1, 0xf39e7113 },
        { 0xd8464cd1, 0xe1161d7c, 0x65770993, 0x224912b4, 0xa8b8ca43, 0x93193e2b, 0x2d1b69af, 0xccfa0129 },
        { 0x9b493e88, 0x543b0e83, 0xa90ab006, 0x152285ff, 0xdfaa8c65, 0xe596ffb3, 0x3edee4be, 0xc84ad4e0 },
        { 0x9d8946a6, 0xc62e2a8a, 0xb1df0c9f, 0x9ace86f9, 0xf1e289bf, 0xb48561e7, 0x0e65593c, 0x0a17586c },
        { 0xdb0a1f5e, 0x437c0f74, 0x8a0e9cad, 0x05132da4, 0x35e78bbd, 0x37938cf8, 0x7ce62fc9, 0x39deb0d7 },
        { 0x41b2269a, 0x429e6a19, 0xd29fb79a, 0xc34e757b, 0x8a176914, 0x0eead690, 0xb5d5a375, 0x1804aa71 },
        { 0x2e6f665c, 0x5b63b063, 0x4d9255e5, 0x5947693d, 0xe35f01a7, 0xefca1819, 0x43bfe313, 0xbd846c1a },
        { 0x74f5513b, 0x6ba6005c, 0x8a25fc62, 0x932366ba, 0x2d24e1be, 0x63a9785a, 0x9117329c, 0xe4301b6d },
        { 0xf3625696, 0xd6b4f0e7, 0xd7e6d00b, 0xb14e678a, 0x25c5dacd, 0x7759ddc7, 0x367812c9, 0x72a00a45 },
        { 0x8d24924a, 0x260a74f2, 0xd14b9d61, 0x2c9f6f4e, 0x5481e717, 0xe7fc2a31, 0x13b27f0a, 0xdcb3bec5 },
        { 0xac88d5b1, 0xcc746be7, 0x4e570bb1, 0xabb5ea32, 0x129d9603, 0x5ae55a5d, 0x8468b663, 0xd12be04f },
        { 0xcfad8a23, 0x19cce9f4, 0xb447a727, 0xc70efbeb, 0xf17880f3, 0x52c6c1d3, 0xadb2abf6, 0xc3e8bcb1 },
        { 0x092f7779, 0x158b9b36, 0x3b92a3f3, 0x111fb364, 0x5651fd5f, 0xfb32fc2d, 0x29071ae3, 0xc36591eb },
        { 0xc9efb87f, 0xc48a3ae3, 0x4ab7fae9, 0x50da8631, 0x7a9fa560, 0xd86fc456, 0x5e9e94a0, 0xa6b17fac },
        { 0x90c991cb, 0x97d2dcf9, 0xe74f0925, 0xaed89960, 0xbc8af1e4, 0xd99b8daa, 0xe1871074, 0xa2fdffb3 },
        { 0x17659e6f, 0xf40764e7, 0xce5973bd, 0x09bec010, 0x04b82e8c, 0x48f5e7de, 0x0142cbfe, 0x5b6e879d },
        { 0x02e70483, 0x69d054c9, 0xc782d141, 0x79780b10, 0x499ad6e0, 0x9186545c, 0x8bcbc9da, 0x60a521f6 },
        { 0x6cd69a87, 0xebfb444e, 0xfadba9ad, 0x018222a9, 0xaad55b8f, 0x352f0c77, 0x5bb48852, 0xc6b7886e },
        { 0x4484875e, 0xeaa12441, 0x6c288182, 0x0569bda0, 0x9d5b64fb, 0xb5a3dea6, 0x3d560c36, 0x04bc59c3 },
        { 0xbe59f04e, 0x9dede6f7, 0x08d58747, 0xd9bedd44, 0x61578134, 0x61c26685, 0x3398e8d4, 0xa980f191 },
        { 0x043c42c4, 0x3d003e1b, 0x37108216, 0x27e1b0b5, 0x893027c0, 0x3926968b, 0x9c5846b2, 0x18cb9f5c },
        { 0xc3bb94dc, 0x5bd51d2d, 0xc381bc08, 0x8e93e5ea, 0x97421c75, 0xc742a1f5, 0xaa8f7d17, 0x2d6c19ce },
        { 0x31a427b4, 0x23036026, 0xf18e71fd, 0x0f29d624, 0x8e2a60a0, 0xccdbfd55, 0xef0959f4, 0xac0dcd1d },
        { 0x391c6764, 0xe2512239, 0x9036bd46, 0xc94347e7, 0x5882d284, 0x9f878c00, 0x4b1130dd, 0x21df4ca8 },
        { 0x7b5f53f0, 0xec38b013, 0x55c892f5, 0x6e69796d, 0x7f0455d8, 0x96e46335, 0x48773446, 0x80d97a2d },
        { 0xe1d30de7, 0xc95a4214, 0x6a35f831, 0x80ecd528, 0xa1050db8, 0x0bb16b54, 0xd754202a, 0x30102a5b },
        { 0x49c1c5d1, 0x1259bc03, 0xf484410e, 0x037a71a7, 0x1e2f7860, 0x2fad8338, 0x47c1a825, 0xef2ed067 },
        { 0xa43756df, 0x009d4ef3, 0x0be86887, 0x5d76e495, 0x5ac79bed, 0x38e19c1d, 0x0303c3df, 0x471c7bd7 },
        { 0xd4aa263f, 0x332b04ad, 0x663eaa61, 0xc3f20fc7, 0xc135b437, 0x960347ea, 0x2cabf456, 0xfab7876a },
        { 0xe5e2df6c, 0x420fb719, 0x6d3ba498, 0xc0fdd098, 0x8707312a, 0x5aa2b046, 0x940bb46f, 0xfc68c410 },
        { 0x83c558a9, 0x256617fd, 0x2bdcea80, 0x8b16647c, 0x1aa21fbb, 0x66a3a82b, 0x6c6be1f1, 0xe36c880e },
        { 0x558b8ec8, 0xf82e0281, 0xfb5ac038, 0xe8825490, 0x03387c33, 0x6b95223c, 0xaf5b40a1, 0xd7bd8b95 },
        { 0xda508a6d, 0xc665de02, 0x3b30c66b, 0x9f9eee80, 0x7ac89457, 0x2bcc238a, 0x6d49e781, 0x5e30c0d3 },
        { 0xdd431922, 0x7307eb16, 0x2857ef84, 0x833743ce, 0xa7b7e3b4, 0xee0aa54f, 0x99d9c004, 0x129960db },
        { 0xfa1a525d, 0x321e2716, 0x2a708c5f, 0xbbac593e, 0x4944c1f6, 0x44b28515, 0x633b256a, 0xa42151ab },
        { 0x49cab357, 0x1b1161b1, 0xfeb9c897, 0xf74f9e50, 0x9b930d43, 0xe1deabde, 0x0e50ec43, 0x39a02259 },
        { 0x56c2f75c, 0xf47a00d0, 0x6645d72b, 0xd3faddec, 0x20678a3f, 0x2661529d, 0x78f799ed, 0x6d81f2b7 },
        { 0xfa7ac138, 0x47708ba6, 0xbae343f2, 0x993c082d, 0x23ea21de, 0xae7bb53e, 0x94b1b739, 0x530d2680 },
        { 0x4238331c, 0xe7548e6d, 0x46bd6bbe, 0x6e48261d, 0x7a0e857e, 0x8b6539ed, 0xdf159ade, 0x22a81d5f },
        { 0x669817e5, 0xc1069206, 0x767d13ac, 0xdf04f7f4, 0x88345f5f, 0x3f834efe, 0xbd88d81a, 0xae1bca1e },
        { 0x66254e0e, 0xd6059608, 0x3efbf5ea, 0xc6bfdf0a, 0x2ae566b8, 0x5a840089, 0x9e4b7908, 0x541a3cad },
        { 0x20d930cb, 0x66d89fc9, 0xa0d3c820, 0x4c4ee052, 0x71d3b759, 0x6d3cea5c, 0x0c7fe715, 0x236c8d04 },
        { 0xbfe0efba, 0xd36dc0c6, 0x01f13d5a, 0x7f53a23d, 0xd499bc54, 0xa66bd0bc, 0x17fa4d9f, 0x6eb5caf8 },
        { 0xe4edc3e3, 0x5bbdecc0, 0x209e8e04, 0x1950e684, 0x2bebce6d, 0x3b9d3657, 0x000560c5, 0x641dfc24 },
        { 0xd3d8db2e, 0x626ecfe9, 0xdd62b6c2, 0x5c31b41d, 0x06f2c1f6, 0x0df1f6c7, 0x664c6895, 0x95e9ccba },
        { 0x6edac767, 0x67b3a00d, 0xcc28be85, 0x749a2e54, 0xf6f94551, 0x2c422c72, 0xcafedf4a, 0xa1b39d9b },
        { 0xa1fe7c91, 0xa9352494, 0xd45e6c0f, 0xb55d4332, 0x46157234, 0xe5a46a81, 0xc9dbeb44, 0xcd2ab3f2 },
        { 0x9ab78833, 0x8b60acb2, 0x8d58ba19, 0x8cba6282, 0x72e75f2e, 0xc1e2574c, 0x95a93e02, 0x01b2a163 }
    };

    XmssSigningContext *context = NULL;
    XmssError err = xmss_context_initialize(&context, XMSS_PARAM_SHAKE256_10_256, realloc, free, NULL);
    if (err != XMSS_OKAY) {
        printf("Failed to initialize signing context for SHAKE256_256.\n");
        return false;
    }

    wotsp_sign(context, &signature, &message_digest, &secret_seed, &public_seed, 0);

    bool success = memcmp(expected_signature, &signature, sizeof(WotspSignature)) == 0;
    printf("WOTS+ signing test for SHAKE256_256 %s.\n", success ? "succeeded" : "failed");

    return success;
}
#endif /* XMSS_ENABLE_SHAKE256_256 */

static bool test_verify(void)
{
    const enum XmssParameterSetOID params[] = {
#if XMSS_ENABLE_SHA256
    XMSS_PARAM_SHA2_10_256,
#endif
#if XMSS_ENABLE_SHAKE256_256
    XMSS_PARAM_SHAKE256_10_256,
#endif
    };
    const char *hash_names[] = {
#if XMSS_ENABLE_SHA256
    "SHA256",
#endif
#if XMSS_ENABLE_SHAKE256_256
    "SHAKE256_256"
#endif
    };
    const size_t num_params = sizeof(params) / sizeof(enum XmssParameterSetOID);
    const XmssNativeValue256 secret_seed = { { 0x01000000 } };
    const XmssNativeValue256 public_seed = { { 0x02000000 } };
    const XmssNativeValue256 message_digest = { {
        0x01020304, 0x05060708, 0x090a0b0c, 0x0d0e0f10, 0x11121314, 0x15161718, 0x191a1b1c, 0x1d1e1f20
    } };
    const XmssNativeValue256 bad_digest = { { 0 } };
    WotspPublicKey public_key;
    WotspPublicKey expected_public_key;
    WotspSignature signature;
    bool overall_success = true;

    for (size_t i = 0; i < num_params; i++) {
        XmssSigningContext *context = NULL;
        XmssError err = xmss_context_initialize(&context, params[i], realloc, free, NULL);
        if (err != XMSS_OKAY) {
            printf("Failed to initialize signing context for %s.\n", hash_names[i]);
            return false;
        }

        wotsp_gen_public_key(context, &public_key, &secret_seed, &public_seed, 0);
        wotsp_sign(context, &signature, &message_digest, &secret_seed, &public_seed, 0);

        /* Check that we calculate the right public key for the signed message. */
        wotsp_calculate_expected_public_key(HASH_ABSTRACTION(&context->hash_functions) &expected_public_key,
            &message_digest, &signature, &public_seed, 0);
        bool success = memcmp(&public_key, &expected_public_key, sizeof(public_key)) == 0;
        if (!success) {
            printf("Failed to verify correct signature for %s.\n", hash_names[i]);
        }
        overall_success = overall_success && success;

        /* Check that we calculate a different public key for an incorrect message. */
        wotsp_calculate_expected_public_key(HASH_ABSTRACTION(&context->hash_functions) &expected_public_key,
            &bad_digest, &signature, &public_seed, 0);
        success = memcmp(&public_key, &expected_public_key, sizeof(public_key)) != 0;
        if (!success) {
            printf("Incorrectly verified a wrong signature for %s.\n", hash_names[i]);
        }
        overall_success = overall_success && success;
    }

    return overall_success;
}

int main(void)
{
    /* Key generation tests. */
    bool keygen_success = true;
#if XMSS_ENABLE_SHA256
    keygen_success = keygen_success && test_pubkey_gen_sha256();
#endif
#if XMSS_ENABLE_SHAKE256_256
    keygen_success = keygen_success && test_pubkey_gen_shake256_256();
#endif
    printf("WOTS+ public key generation test %s.\n", keygen_success ? "succeeded" : "failed");

    /* Signing tests. */
    bool signing_success = true;
#if XMSS_ENABLE_SHA256
    signing_success = signing_success && test_sign_sha256();
#endif
#if XMSS_ENABLE_SHAKE256_256
    signing_success = signing_success && test_sign_shake256_256();
#endif
    printf("WOTS+ signing test %s.\n", signing_success ? "succeeded" : "failed");

    /* Verification tests. */
    bool verification_success = test_verify();
    printf("WOTS+ verification test %s.\n", verification_success ? "succeeded" : "failed");

    return (keygen_success && signing_success && verification_success) ? EXIT_SUCCESS : EXIT_FAILURE;
}
